<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Date</title>

	<script src="https://code.jquery.com/jquery-3.3.1.min.js"
		integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
		integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
		crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
		integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
		crossorigin="anonymous"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
		integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

	<script src="../js/utility.js"></script>
</head>

<body>

	<body>
		<!-- Navigation -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
			<div class="container">
				<a class="navbar-brand" href="#">Scrum Project</a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
					aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
					<span class="navbar-toggler-icon"></span>
				</button>
				<div class="collapse navbar-collapse" id="navbarResponsive">
					<ul class="navbar-nav ml-auto" id="navigationElements">
					</ul>
				</div>
			</div>
		</nav>

		<script type="text/javascript">
			window.onload = function () {
			let rooturl = "https://scrumserver.tenobe.org/scrum/api";
			
			
			
				// Gebruiker is ingelogd, naar profiel
				if (!IsIngelogd()) {
					Redirect('../index.html')
					return;
				}
				console.log(window.location)
				// profiel.html?id=2 => 2
				let profielId = parseInt($_GET('id'))
				let gebruikerProfielId = GeefGebruikerID();
				let gebruikerUrl = ROOT_URL + '/profiel/read_one.php?id=' + gebruikerProfielId;
				console.log("$GET ", profielId, gebruikerProfielId);
				
				// Geen ?id dus neem gebruikerprofiel
				if (isNaN(profielId)) {
					profielId = GeefGebruikerID();
					console.log("ID ", profielId)
				}
				let url = ROOT_URL + '/profiel/read_one.php?id=' + profielId;
				console.log(url)
				fetch(url)
					.then(function (resp) { return resp.json(); })
					.then(function (data) {
						console.log(data)
						fillUpProfile(data);
					})
					.catch(function (error) { console.log("ERROR " + error); });

					if (gebruikerProfielId != profielId){
					lovecoins (rooturl,gebruikerProfielId,profielId,gebruikerUrl);
					}
					}
			/*einde window.onload*/
			
			function lovecoins(rooturl,gebruikerProfielId,profielId,gebruikerUrl){
					
					fetch(gebruikerUrl)
					.then(function (resp) { return resp.json(); })
					.then(function (data) {
						console.log(data);
						var toonKnop = document.getElementById('showAllHiddenInfo');
						toonKnop.addEventListener('click',function () {
						var sSaldo = data.lovecoins;
						console.log(sSaldo);
						var totaal = parseInt(sSaldo) - 1; 
						if (sSaldo > 0){
						let urlUpdate=rooturl+'/profiel/update.php?id=' + gebruikerProfielId;
						
						
                        data.lovecoins = totaal;
						
						console.log(data);
						
						console.log(totaal);

                        var request = new Request(urlUpdate, {
                            method: 'PUT',
                            body: JSON.stringify(data),
                            headers: new Headers({
                                'Content-Type': 'application/json'
                            })
                        });
                        fetch(request)
                            .then(function (resp)   { return resp.json(); })
                            .then(function (data)   { console.log(data);  
							
							
							
							})
                            .catch(function (error) { console.log(error); });   
							
							/*functie schrijven die alles toont*/
							fillUpProfileAangepast(data);
							}
							else {
							alert('U heeft onvoldoende lovecoins');
							}
							
					}); ;})
					
					
					
					}
					
			function fillUpProfile(profile) {


				for (var key in profile) {
					if (key === "id") { continue; }
					if (key === "foto") { continue; }
					/* Op eigen profiel toon je alles */
					if(GeefGebruikerID() === profile.id) {
						$('#displayElement').append("<li class='list-group-item'><p><span> " + key + ": " + profile[key] + "</span></p></li>");
					} else {
						/* Op een ander profiel mag je enkel de niet-private velden bekijken */
						if (PRIVATE_ELEMENTS[key] === true) { //defined AND true 							
							console.log(key + " NIET tonen " + PRIVATE_ELEMENTS[key]);
							$('#displayElement').append("<li style='display:none' class='list-group-item'> " + key + ": " + profile[key] + "</li>")
						} else { //not defined   OR   defined but not true
							console.log(key + " WEL tonen " + PRIVATE_ELEMENTS[key]);
							$('#displayElement').append("<li class='list-group-item'><p><span'> " + key + ": " + profile[key] + "</span></p></li>");
						}
					}

				}
				if (typeof profile.geboortedatum != 'undefined') {
					// Sterrenbeeld
					let day = profile.geboortedatum.substring(profile.geboortedatum.lastIndexOf('-') + 1, profile.geboortedatum.length)
					let month = profile.geboortedatum.substring(profile.geboortedatum.indexOf('-', 2) + 1, profile.geboortedatum.lastIndexOf('-'))
					//$('#zodic').text("Sterrenbeeld: " + GeefSterrenBeeld(day, month))
					$('#displayElement').append("<li class='list-group-item'><p><span'> " + "Sterrenbeeld" + ": " + GeefSterrenBeeld(day, month) + "</span></p></li>");
					//todo fixme correcte afbeelding tonen links onder profielfoto

				}
				if (typeof profile.foto != 'undefined') {
					var imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/" + profile[key];
					console.log(imgLocationOnServer);
					let eImageToLoad = document.getElementById("profileImageToLoad");
					eImageToLoad.src = imgLocationOnServer;
					eImageToLoad.onerror = function(){
						imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/no_image.png"
						eImageToLoad.src = imgLocationOnServer;
					}
				}
				/* Jezelf als favoriet toevoegen of gegevens unlocken met LC is niet nodig op je eigen profiel */				
				if(GeefGebruikerID() === profile.id) {
					$("#addToFavorites").css("display", "none");
					$("#showAllHiddenInfo").css("display", "none");
				} else {
					var eAddProfileToFavorites = document.getElementById("addToFavorites");	
					eAddProfileToFavorites.addEventListener('click', onAddToFavoritesClick);
					function onAddToFavoritesClick(evt) {
		                let mijnId =  GeefGebruikerID(); 
		                let anderId =  profile.id;
		                let url=ROOT_URL+'/favoriet/like.php';
		                let data = {
		                    mijnId: mijnId,
		                    anderId: anderId
		                }
		                var request = new Request(url, {
		                    method: 'POST',
		                    body: JSON.stringify(data),
		                    headers: new Headers({
		                        'Content-Type': 'application/json'
		                    })
		                });
		                
		                fetch(request)
		                    .then( function (resp)  { return resp.json(); })
		                    .then( function (data)  { console.log(data);  })
		                    .catch(function (error) { console.log(error); });
					}
				}
			
		

				

				if (typeof profile.foto != 'undefined') {
					var imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/" + profile[key];
					console.log(imgLocationOnServer);
					let eImageToLoad = document.getElementById("profileImageToLoad");
					eImageToLoad.src = imgLocationOnServer;
					eImageToLoad.onerror = function(){
						imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/no_image.png"
						eImageToLoad.src = imgLocationOnServer;
					}
				}

				/* Jezelf als favoriet toevoegen of gegevens unlocken met LC is niet nodig op je eigen profiel */				
				if(GeefGebruikerID() === profile.id) {

					$("#addToFavorites").css("display", "none");
					$("#showAllHiddenInfo").css("display", "none");

				} else {

					var eAddProfileToFavorites = document.getElementById("addToFavorites");	
					eAddProfileToFavorites.addEventListener('click', onAddToFavoritesClick);

					function onAddToFavoritesClick(evt) {

		                let mijnId =  GeefGebruikerID(); 
		                let anderId =  profile.id;

		                let url=ROOT_URL+'/favoriet/like.php';

		                let data = {
		                    mijnId: mijnId,
		                    anderId: anderId
		                }

		                var request = new Request(url, {
		                    method: 'POST',
		                    body: JSON.stringify(data),
		                    headers: new Headers({
		                        'Content-Type': 'application/json'
		                    })
		                });
		                
		                fetch(request)
		                    .then( function (resp)  { return resp.json(); })
		                    .then( function (data)  { console.log(data);  })
		                    .catch(function (error) { console.log(error); });
					}

				}

			
		}
		
		
		function fillUpProfileAangepast(profile) {


				for (var key in profile) {
					if (key === "id") { continue; }
					if (key === "foto") { continue; }
					console.log(key);
						/* Op een ander profiel mag je enkel de niet-private velden bekijken */
						if ((PRIVATE_ELEMENTS[key] === true) && (key != 'wachtwoord') && (key != 'lovecoins')) { //defined AND true 							
							console.log(key + " NIET tonen " + PRIVATE_ELEMENTS[key]);
							$('#displayElement').append("<li style='display:block' class='list-group-item'> " + key + ": " + profile[key] + "</li>")
						} 
					}

					//todo fixme correcte afbeelding tonen links onder profielfoto

				
				if (typeof profile.foto != 'undefined') {
					var imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/" + profile[key];
					console.log(imgLocationOnServer);
					let eImageToLoad = document.getElementById("profileImageToLoad");
					eImageToLoad.src = imgLocationOnServer;
					eImageToLoad.onerror = function(){
						imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/no_image.png"
						eImageToLoad.src = imgLocationOnServer;
					}
				}
				/* Jezelf als favoriet toevoegen of gegevens unlocken met LC is niet nodig op je eigen profiel */				
				if(GeefGebruikerID() === profile.id) {
					$("#addToFavorites").css("display", "none");
					$("#showAllHiddenInfo").css("display", "none");
				} else {
					var eAddProfileToFavorites = document.getElementById("addToFavorites");	
					eAddProfileToFavorites.addEventListener('click', onAddToFavoritesClick);
					function onAddToFavoritesClick(evt) {
		                let mijnId =  GeefGebruikerID(); 
		                let anderId =  profile.id;
		                let url=ROOT_URL+'/favoriet/like.php';
		                let data = {
		                    mijnId: mijnId,
		                    anderId: anderId
		                }
		                var request = new Request(url, {
		                    method: 'POST',
		                    body: JSON.stringify(data),
		                    headers: new Headers({
		                        'Content-Type': 'application/json'
		                    })
		                });
		                
		                fetch(request)
		                    .then( function (resp)  { return resp.json(); })
		                    .then( function (data)  { console.log(data);  })
		                    .catch(function (error) { console.log(error); });
					}
				}
			
		

				

				if (typeof profile.foto != 'undefined') {
					var imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/" + profile[key];
					console.log(imgLocationOnServer);
					let eImageToLoad = document.getElementById("profileImageToLoad");
					eImageToLoad.src = imgLocationOnServer;
					eImageToLoad.onerror = function(){
						imgLocationOnServer = ROOT_URL.substring(0, ROOT_URL.length-3) + "img/no_image.png"
						eImageToLoad.src = imgLocationOnServer;
					}
				}

				/* Jezelf als favoriet toevoegen of gegevens unlocken met LC is niet nodig op je eigen profiel */				
				if(GeefGebruikerID() === profile.id) {

					$("#addToFavorites").css("display", "none");
					$("#showAllHiddenInfo").css("display", "none");

				} else {

					var eAddProfileToFavorites = document.getElementById("addToFavorites");	
					eAddProfileToFavorites.addEventListener('click', onAddToFavoritesClick);

					function onAddToFavoritesClick(evt) {

		                let mijnId =  GeefGebruikerID(); 
		                let anderId =  profile.id;

		                let url=ROOT_URL+'/favoriet/like.php';

		                let data = {
		                    mijnId: mijnId,
		                    anderId: anderId
		                }

		                var request = new Request(url, {
		                    method: 'POST',
		                    body: JSON.stringify(data),
		                    headers: new Headers({
		                        'Content-Type': 'application/json'
		                    })
		                });
		                
		                fetch(request)
		                    .then( function (resp)  { return resp.json(); })
		                    .then( function (data)  { console.log(data);  })
		                    .catch(function (error) { console.log(error); });
					}

				}

			
		}
		



		</script>

		<body>
			<div class="container mt-4">

				<div style="display:flex; flex-direction:row; justify-content:center;">
					
					<div style="display:flex; flex-direction:column; justify-content:space-evenly; flex-wrap: wrap; width:35%; align-items:center;">
						<img src="404image" style="min-width: 80%; max-width:80%; padding:1em;" id="profileImageToLoad">	<!--  -->
						<img src="../img/horoscopen.jpg" style="min-width: 80%; max-width:80%; padding:1em;">
					</div>

					<div style="width:65%;">
						<h3>Profiel</h3>
						<ul class="list-group mt-4" id='displayElement'></ul>
<!-- fixme deze niet tonen op eigen profiel, tekst veranderen naar verwijder als het profiel dat je bekijkt van iemand is die je reeds hebt toegevoegd als favoriet, en laat ze nog floaten met flex -->
						<div>
							<button type="submit" id="showAllHiddenInfo" class="btn btn-primary mt-2">Toon alles (1 LC)</button>
							<button style="float:right;" type="submit" class="btn btn-primary mt-2" id="addToFavorites">Voeg toe als favoriet (1 LC)</button>					
						</div>
<!-- fixme deze niet tonen op eigen profiel, tekst veranderen naar verwijder als het profiel dat je bekijkt van iemand is die je reeds hebt toegevoegd als favoriet, en laat ze nog floaten met flex -->	
					</div>

				</div>

			</div>
		</body>

</html>

    © 2019 GitHub, Inc.
    Terms
    Privacy
    Security
    Status
    Help

    Contact GitHub
    Pricing
    API
    Training
    Blog
    About

